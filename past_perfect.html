<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Past Perfect! - Interactive Grammar Education</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'background': '#ffffff',
                        'foreground': '#475569',
                        'card': '#e0e7ff',
                        'primary': '#6366f1',
                        'secondary': '#818cf8',
                        'accent': '#818cf8',
                        'muted': '#e0e7ff',
                        'border': '#d1d5db',
                        'pastperf': '#6366f1',
                        'pastperf-light': '#e0e7ff',
                        'pastperf-foreground': '#1f2937'
                    },
                    fontFamily: {
                        'heading': ['Inter', 'sans-serif'],
                        'body': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<style type="text/css">
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow-x: hidden; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: white; min-height: 100vh;
        }
        .floating-elements { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .floating-shape { position: absolute; opacity: 0.3; animation: float 6s ease-in-out infinite; }
        .floating-shape:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .floating-shape:nth-child(2) { top: 20%; right: 10%; animation-delay: 1s; }
        .floating-shape:nth-child(3) { top: 60%; left: 5%; animation-delay: 2s; }
        .floating-shape:nth-child(4) { bottom: 20%; right: 15%; animation-delay: 3s; }
        .floating-shape:nth-child(5) { bottom: 10%; left: 20%; animation-delay: 4s; }

        .nav {
            position: fixed; top: 0; width: 100%; padding: 15px 30px;
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(25px) saturate(180%);
            z-index: 1000; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        .nav::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
        }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; position: relative; z-index: 2; }
        .logo {
            font-size: 28px; font-weight: bold; cursor: pointer; transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffd93d); background-size: 200% 200%;
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; animation: gradientShift 3s ease-in-out infinite;
        }
        .logo:hover { transform: scale(1.15) rotate(5deg); filter: drop-shadow(0 0 20px rgba(255,107,107,0.6)); }

        .nav-links { display: flex; list-style: none; gap: 0; align-items: center; }
        .nav-links > li { position: relative; margin: 0 10px; }
        .nav-links > li > a {
            color: white; text-decoration: none; font-weight: bold; font-size: 18px; padding: 12px 20px; border-radius: 25px;
            transition: all 0.3s cubic-bezier(0.4,0,0.2,1); text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
            display: flex; align-items: center; gap: 8px; position: relative; overflow: hidden;
        }
        .nav-links > li > a::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease;
        }
        .nav-links > li > a:hover::before { left: 100%; }
        .nav-links > li > a:hover {
            transform: translateY(-3px) scale(1.05); background: rgba(255,255,255,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-color: rgba(255,255,255,0.4);
        }

        .nav-links li ul {
            display: none; position: absolute; top: calc(100% + 15px); left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(255,255,255,0.95); backdrop-filter: blur(20px) saturate(180%);
            min-width: 200px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.3);
            padding: 15px 0; opacity: 0; visibility: hidden; transition: all 0.4s cubic-bezier(0.4,0,0.2,1); z-index: 1000;
        }
        .nav-links li ul::before {
            content: ''; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid rgba(255,255,255,0.95);
        }
        .nav-links li:hover ul { display: block; opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .nav-links li ul li { display: block; padding: 0; margin: 0; position: relative; overflow: hidden; }
        .nav-links li ul li a {
            text-decoration: none; color: #333; display: block; padding: 12px 25px; font-size: 16px; font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4,0,0.2,1); border-radius: 15px; margin: 0 10px; position: relative; background: transparent; border: none; backdrop-filter: none;
        }
        .nav-links li ul li a::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0; height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4); transition: width 0.3s ease; border-radius: 15px; z-index: -1;
        }
        .nav-links li ul li a:hover::before { width: 100%; }
        .nav-links li ul li a:hover { color: white; transform: translateX(10px) scale(1.02); text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }

        .dropdown-arrow { width: 16px; height: 16px; transition: transform 0.3s ease; opacity: 0.7; }
        .nav-links li:hover .dropdown-arrow { transform: rotate(180deg); opacity: 1; }

        .mobile-menu-toggle {
            display: none; flex-direction: column; cursor: pointer; padding: 8px; border-radius: 8px;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease;
        }
        .mobile-menu-toggle:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
        .mobile-menu-toggle span { width: 25px; height: 3px; background: white; margin: 3px 0; border-radius: 2px; transition: all 0.3s ease; }
        .mobile-menu-toggle.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .mobile-menu-toggle.active span:nth-child(2) { opacity: 0; }
        .mobile-menu-toggle.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }

        .container { max-width: 1000px; margin: 0 auto; padding: 100px 20px 20px; }
        .header { text-align: center; margin-bottom: 40px; animation: bounceIn 1s ease; }
        .header h1 { font-size: clamp(2.5rem, 6vw, 4rem); color: white; margin-bottom: 15px; font-weight: bold; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }
        .header p { font-size: clamp(1.2rem, 3vw, 1.6rem); color: rgba(255,255,255,0.95); text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }

        .mode-toggle { display: flex; justify-content: center; margin-bottom: 40px; animation: slideInUp 1s ease 0.3s both; }
        .mode-buttons { background: rgba(255,255,255,0.2); backdrop-filter: blur(15px); border-radius: 20px; padding: 8px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); border: 2px solid rgba(255,255,255,0.3); }
        .mode-btn { padding: 15px 30px; border: none; background: transparent; color: white; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.3s; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .mode-btn.active { background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; transform: scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .mode-btn:hover:not(.active) { background: rgba(255,255,255,0.2); transform: translateY(-2px); }

        .learning-card {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(20px); border-radius: 25px; padding: 40px; text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2); margin-bottom: 30px; border: 2px solid rgba(255,255,255,0.3); animation: slideInUp 1s ease 0.6s both;
        }
        .card-title { font-size: 2rem; margin-bottom: 30px; color: rgba(255,255,255,0.95); text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }

        .number-display {
            font-size: 6rem; font-weight: bold; color: #4ecdc4; margin-bottom: 20px; transition: all 0.5s ease;
            text-shadow: 0 0 30px rgba(78,205,196,0.6); animation: pulse 2s ease-in-out infinite;
        }
        .number-words { font-size: 2.5rem; color: #ff6b6b; font-weight: bold; text-transform: capitalize; text-shadow: 0 0 20px rgba(255,107,107,0.4); margin-bottom: 20px; }

        .shape-display { display: flex; justify-content: center; align-items: center; margin: 30px 0; min-height: 200px; }
        .shape { transition: all 0.5s ease; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3)); animation: rotate 4s linear infinite; }
        .shape:hover { transform: scale(1.2); animation-play-state: paused; }
        .shape-name { font-size: 2.5rem; color: #ff6b6b; font-weight: bold; text-transform: capitalize; text-shadow: 0 0 20px rgba(255,107,107,0.4); margin-top: 20px; }

        .controls {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; animation: slideInUp 1s ease 0.9s both;
        }
        .control-btn {
            padding: 18px 25px; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;
            backdrop-filter: blur(15px); border: 2px solid rgba(255,255,255,0.3); color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .control-btn:hover:not(:disabled) { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 30px rgba(0,0,0,0.3); }
        .control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-green { background: linear-gradient(45deg, #10b981, #34d399); }
        .btn-orange { background: linear-gradient(45deg, #f97316, #fb923c); }
        .btn-red { background: linear-gradient(45deg, #ef4444, #f87171); }
        .btn-blue { background: linear-gradient(45deg, #2563eb, #60a5fa); }
        .btn-purple { background: linear-gradient(45deg, #8b5cf6, #a78bfa); }

        .quick-jump {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(20px); border-radius: 25px; padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); margin-bottom: 30px; border: 2px solid rgba(255,255,255,0.3); animation: slideInUp 1s ease 1.2s both;
        }
        .quick-jump h3 { text-align: center; margin-bottom: 25px; font-size: 1.8rem; color: rgba(255,255,255,0.95); text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .jump-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .jump-btn {
            padding: 15px; border: 2px solid rgba(255,255,255,0.4); background: rgba(255,255,255,0.2); backdrop-filter: blur(15px);
            color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; font-size: 16px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .jump-btn:hover { border-color: #4ecdc4; background: rgba(78,205,196,0.3); transform: translateY(-3px) scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        .color-picker { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .color-option {
            width: 70px; height: 70px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; border: 4px solid rgba(255,255,255,0.5);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .color-option:hover { transform: scale(1.3) rotate(10deg); border-color: white; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }

        .hidden { display: none; }

        @keyframes gradientShift { 0%,100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes float { 0%,100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-30px) rotate(180deg); } }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes rotate { from { transform: rotate(0); } to { transform: rotate(360deg); } }
        @keyframes rainbow { 0% { filter: hue-rotate(0); } 100% { filter: hue-rotate(360deg); } }

        /* Mobile fixes: disable ‚Äúunwanted transitions/animations‚Äù and make sidebar full-height scrollable */
        @media (max-width: 768px) {
            .nav { padding: 10px 15px; }
            .mobile-menu-toggle { display: flex; }
            .nav-links {
                position: fixed; top: 64px; /* approx nav height */
                left: 0; right: 0; bottom: 0;
                background: rgba(255,255,255,0.95);
                backdrop-filter: blur(20px);
                flex-direction: column; padding: 20px;
                border-radius: 0 0 20px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                transform: translateY(-20px); opacity: 0; visibility: hidden; transition: opacity 0.3s ease, transform 0.3s ease;
                overflow-y: auto; -webkit-overflow-scrolling: touch; overscroll-behavior: contain;
            }
            .nav-links.active { transform: translateY(0); opacity: 1; visibility: visible; }
            .nav-links > li { margin: 10px 0; width: 100%; }
            .nav-links > li > a { justify-content: center; color: #333; background: rgba(255,255,255,0.8); width: 100%; }
            .nav-links li ul {
                position: static; transform: none; background: rgba(255,255,255,0.9);
                margin-top: 10px; border-radius: 15px; display: block; opacity: 1; visibility: visible;
            }
            .nav-links li ul::before { display: none; }
            .container { padding: 80px 15px 20px; }
            .number-display { font-size: 4rem; }
            .number-words, .shape-name { font-size: 2rem; }
            .controls { grid-template-columns: repeat(2, 1fr); }
            .color-option { width: 60px; height: 60px; }
            /* Disable heavy animations/transitions on touch devices to avoid unwanted motion */
            .floating-shape, .shape, .nav-links > li > a::before { animation: none !important; transition: none !important; }
        }

        /* Arabic submenu styles kept */
        ul { list-style: none; padding: 0; margin: 0; }
        li { position: relative; display: inline-block; padding: 10px; }
        li ul {
            display: none; position: absolute; background-color:#f9f9f9; min-width: 100px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.2); z-index: 1; cursor: pointer;
        }
        li:hover ul { display: block; }
        li ul li { display: block; padding: 8px; }
        li ul li a { text-decoration: none; color: black; display: block; }
        li ul li a:hover { background-color: black; color: white; }
        .dropdown-arrow { width: 1em; height: 1em; margin-left: 5px; }

        /* Prevent background scroll when sidebar open */
        body.no-scroll { overflow: hidden; position: fixed; width: 100%; }




                /*in smart phone */

        /* ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÅŸä ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
.nav-links {
  display: flex;
  list-style: none;
  gap: 20px;
}

@media (max-width: 768px) {
            .nav {
                padding: 10px 15px;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .nav-links {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                flex-direction: column;
                padding: 20px;
                border-radius: 0 0 20px 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                transform: translateY(-20px);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .nav-links > li {
                margin: 10px 0;
                width: 100%;
            }
            
            .nav-links > li > a {
                justify-content: center;
                color: #333;
                background: rgba(255, 255, 255, 0.8);
                width: 100%;
            }
            
            .nav-links li ul {
                position: static;
                transform: none;
                background: rgba(255, 255, 255, 0.9);
                margin-top: 10px;
                border-radius: 15px;
                display: block;
                opacity: 1;
                visibility: visible;
            }
            
            .nav-links li ul::before {
                display: none;
            }
            
            .container {
                padding: 80px 15px 20px;
            }
            
            .number-display {
                font-size: 4rem;
            }
            
            .number-words, .shape-name {
                font-size: 2rem;
            }
            
            .controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .color-option {
                width: 60px;
                height: 60px;
            }
        }
</style>
<body class="bg-gradient-to-br from-pastperf-light to-white text-foreground font-body">


 <nav class="nav">
        <div class="nav-container">
            <div class="logo" onclick="scrollToTop()">üåü English with Abde </div>
            <div class="mobile-menu-toggle" onclick="toggleMobileMenu()"><span></span><span></span><span></span></div>
            <ul class="nav-links" id="navLinks">
                <li>
                    <a href="#numbers">üî¢ Courses
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </a>
                    <ul>
                        <li><a href="index.html" onclick="setMode('numbers')">üè† Home</a></li>
                        <li class="mode-btn" id="shapesBtn" onclick="setMode('shapes')"><a href="index.html">üìö  Numbers &üß™ Shapes</a></li>
                        <li><a href="color.html">‚úèÔ∏è Colors</a></li>
                        <li><a href="animals.html">üêà Animals </a></li>
                        <li><a href="jobs.html">üë®‚Äçüîß jobs </a></li>
                        <li><a href="seasons.html">üçÇ seasons </a></li>
                        <li><a href="clothes.html">üëó Clothes </a></li>
                        <li><a href="vegetables.html">üçÜ vegetables </a></li>
                        <li><a href="fruits.html">üçé fruits </a></li>
                        <li><a href="countries.html">üåç countries </a></li>
                    </ul>
                </li>
                <li>
                    <a href="#shapes">üî∫ Grammar
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </a>
                    <ul>
                        <li><a href="presentsimple.html">present simple</a></li>
                        <li><a href="present_continues.html"> present Continuous</a></li>
                        <li><a href="present_perfect.html">present perfect</a></li>
                        <li><a href="pastsimple.html">past simple</a></li>
                        <li><a href="past_continue.html">past Continuous</a></li>
                        <li><a href="past_perfect.html">past perfect</a></li>
                        <li><a href="futuresimple.html">future simple</a></li>
                        <li><a href="future_continue.html">future Continuous</a></li>
                        <li><a href="future_perfect.html">future perfect</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#themes">Conversation
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </a>
                    <ul>
                        <li><a href="school.html">In school</a></li>
                        <li><a href="restaurant.html">In restaurant</a></li>
                        <li><a href="airport.html">In airport</a></li>
                        <li><a href="hotel.html">In hotel</a></li>
                    </ul>
                </li>
            </ul>
        </div>


        <script type="text/javascript">
          
          function toggleMobileMenu() {
    const navLinks = document.getElementById('navLinks');
    const toggle = document.querySelector('.mobile-menu-toggle');
    navLinks.classList.toggle('active');
    toggle.classList.toggle('active');
    document.body.classList.toggle('no-scroll', navLinks.classList.contains('active'));
}

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        </script>
    </nav>


    <!-- Header Section -->
    <header class="bg-pastperf-light py-12 text-center">
        <div class="container mx-auto px-4">
            <h1 class="text-5xl font-heading font-bold text-pastperf mb-4">Learn Past Perfect! ‚è™</h1>
            <p class="text-xl text-foreground max-w-2xl mx-auto">
                Master the past perfect tense and learn to show which action happened first in the past!
            </p>
        </div>
    </header>

    <!-- Grammar Rules Section -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-heading font-bold text-pastperf text-center mb-6">
                    How to Use Past Perfect ‚èÆÔ∏è
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="p-6 bg-pastperf-light rounded-xl">
                        <h3 class="font-bold text-pastperf mb-3">‚úÖ Positive Form</h3>
                        <div class="space-y-2 text-sm">
                            <div><strong>had + past participle</strong></div>
                            <div class="text-blue-600">I <strong>had finished</strong> before you arrived.</div>
                            <div class="text-blue-600">She <strong>had left</strong> when I called.</div>
                            <div class="text-blue-600">They <strong>had eaten</strong> already.</div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-pastperf-light rounded-xl">
                        <h3 class="font-bold text-pastperf mb-3">‚ùå Negative Form</h3>
                        <div class="space-y-2 text-sm">
                            <div><strong>had + not + past participle</strong></div>
                            <div class="text-blue-600">I <strong>hadn't finished</strong> yet.</div>
                            <div class="text-blue-600">She <strong>hadn't left</strong> when I called.</div>
                            <div class="text-blue-600">They <strong>hadn't eaten</strong> anything.</div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-pastperf-light rounded-xl">
                        <h3 class="font-bold text-pastperf mb-3">‚ùì Question Form</h3>
                        <div class="space-y-2 text-sm">
                            <div><strong>Had + subject + past participle?</strong></div>
                            <div class="text-blue-600"><strong>Had</strong> you finished before I arrived?</div>
                            <div class="text-blue-600"><strong>Had</strong> she left already?</div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-pastperf-light rounded-xl">
                        <h3 class="font-bold text-pastperf mb-3">üéØ When to Use</h3>
                        <div class="space-y-1 text-sm">
                            <div>‚Ä¢ Earlier action in the past</div>
                            <div>‚Ä¢ Action before another past action</div>
                            <div>‚Ä¢ With time expressions (before, after, when)</div>
                            <div>‚Ä¢ In reported speech</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Exercise 1: Timeline Sequencing -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-heading font-bold text-pastperf text-center mb-6">
                    Exercise 1: Timeline Sequencing üìÖ
                </h2>
                
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-4 mb-6">
                        <div class="flex items-center space-x-2 bg-pastperf-light px-4 py-2 rounded-full">
                            <span class="text-pastperf">üìÖ</span>
                            <span class="font-semibold">Progress: <span id="timeline-current">1</span>/<span id="timeline-total">6</span></span>
                        </div>
                    </div>
                    
                    <div id="timeline-container" class="mb-6">
                        <div class="text-lg font-semibold text-gray-800 mb-6">
                            Put these events in chronological order and choose the correct past perfect sentence:
                        </div>
                        
                        <div class="bg-gray-100 p-6 rounded-lg mb-6">
                            <h4 class="font-semibold mb-4">Scenario:</h4>
                            <div id="timeline-scenario" class="text-lg mb-4">Loading scenario...</div>
                            
                            <div class="space-y-3" id="timeline-events">
                                <!-- Events will be loaded by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="text-lg font-semibold text-gray-800 mb-4">
                            Which sentence correctly uses past perfect?
                        </div>
                        
                        <div class="grid md:grid-cols-1 gap-4 mb-6" id="timeline-options">
                            <!-- Options will be generated by JavaScript -->
                        </div>
                        
                        <div id="timeline-feedback" class="mt-4 p-3 rounded-lg font-semibold hidden"></div>
                        
                        <div class="flex gap-3 justify-center mt-6">
                            <button
                                id="check-timeline"
                                class="bg-pastperf text-pastperf-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                            >
                                Check Answer ‚úì
                            </button>
                            
                            <button
                                id="next-timeline"
                                class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity hidden"
                            >
                                Next Scenario ‚û°Ô∏è
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Exercise 2: Complete the Story -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-heading font-bold text-pastperf text-center mb-6">
                    Exercise 2: Complete the Detective Story üïµÔ∏è
                </h2>
                
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-4 mb-6">
                        <div class="flex items-center space-x-2 bg-pastperf-light px-4 py-2 rounded-full">
                            <span class="text-pastperf">üïµÔ∏è</span>
                            <span class="font-semibold">Completed: <span id="story-completed">0</span>/<span id="story-total">8</span></span>
                        </div>
                    </div>
                    
                    <div class="bg-pastperf-light p-6 rounded-xl mb-6">
                        <h3 class="font-bold text-pastperf mb-3">üïµÔ∏è Detective Smith's Investigation</h3>
                        <p class="text-gray-700 leading-relaxed">
                            Complete this detective story using the past perfect tense. 
                            Fill in each blank with the correct form of the verb in parentheses.
                        </p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg border-2 border-gray-200 text-left space-y-4" id="detective-story">
                        <!-- Story will be generated by JavaScript -->
                    </div>
                    
                    <div class="flex gap-3 justify-center mt-6">
                        <button
                            id="check-story"
                            class="bg-pastperf text-pastperf-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                        >
                            Check Story ‚úì
                        </button>
                        
                        <button
                            id="reset-story"
                            class="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                        >
                            Reset Story üîÑ
                        </button>
                    </div>
                    
                    <div id="story-feedback" class="mt-6 p-4 rounded-lg hidden">
                        <div class="font-bold text-pastperf mb-2">Complete Story:</div>
                        <div id="complete-detective-story" class="text-gray-700 leading-relaxed text-left"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Exercise 3: Before/After Sentences -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-heading font-bold text-pastperf text-center mb-6">
                    Exercise 3: Before & After Connector Practice üîó
                </h2>
                
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-4 mb-6">
                        <div class="flex items-center space-x-2 bg-pastperf-light px-4 py-2 rounded-full">
                            <span class="text-pastperf">üîó</span>
                            <span class="font-semibold">Progress: <span id="connector-current">1</span>/<span id="connector-total">6</span></span>
                        </div>
                    </div>
                    
                    <div id="connector-container" class="mb-6">
                        <div class="text-lg font-semibold text-gray-800 mb-4">
                            Combine these two sentences using past perfect and the connector:
                        </div>
                        
                        <div class="bg-gray-100 p-6 rounded-lg mb-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">First Action (earlier):</div>
                                    <div class="font-medium text-green-700" id="first-action">Loading...</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">Second Action (later):</div>
                                    <div class="font-medium text-blue-700" id="second-action">Loading...</div>
                                </div>
                            </div>
                            <div class="mt-4 text-center">
                                <div class="text-sm text-gray-600 mb-2">Use this connector:</div>
                                <div class="font-bold text-pastperf text-lg" id="connector-word">before</div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="text-sm text-gray-600 mb-2 block">Your combined sentence:</label>
                            <textarea
                                id="connector-input"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-none h-24 focus:border-pastperf focus:outline-none"
                                placeholder="Write your sentence using past perfect..."
                            ></textarea>
                        </div>
                        
                        <div id="connector-feedback" class="mt-4 p-3 rounded-lg font-semibold hidden"></div>
                        
                        <div class="flex gap-3 justify-center mt-6">
                            <button
                                id="check-connector"
                                class="bg-pastperf text-pastperf-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                            >
                                Check Answer ‚úì
                            </button>
                            
                            <button
                                id="next-connector"
                                class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity hidden"
                            >
                                Next Exercise ‚û°Ô∏è
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Exercise 4: Multiple Choice Challenge -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-heading font-bold text-pastperf text-center mb-6">
                    Exercise 4: Multiple Choice Challenge üéØ
                </h2>
                
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-4 mb-6">
                        <div class="flex items-center space-x-2 bg-pastperf-light px-4 py-2 rounded-full">
                            <span class="text-pastperf">üéØ</span>
                            <span class="font-semibold">Score: <span id="challenge-score">0</span>/<span id="challenge-total">0</span></span>
                        </div>
                    </div>
                    
                    <div id="challenge-container" class="mb-6">
                        <div class="text-xl font-semibold text-gray-800 mb-4" id="challenge-question">
                            Choose the correct past perfect form:
                        </div>
                        
                        <div class="text-lg mb-6 p-4 bg-gray-100 rounded-lg" id="challenge-sentence">
                            Loading question...
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6" id="challenge-options">
                            <!-- Options will be generated by JavaScript -->
                        </div>
                        
                        <div id="challenge-feedback" class="mt-4 p-3 rounded-lg font-semibold hidden"></div>
                        
                        <button
                            id="challenge-next"
                            class="mt-4 bg-pastperf text-pastperf-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                        >
                            Next Question ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Grammar Tips -->
    <section class="py-8 px-4">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                <h2 class="text-2xl font-heading font-bold text-pastperf mb-6">
                    Grammar Tips! üí°
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="p-6 bg-gradient-to-br from-pastperf-light to-white rounded-xl">
                        <div class="text-4xl mb-3">‚è∞</div>
                        <h3 class="font-bold text-gray-800 mb-2">Earlier Past Action</h3>
                        <p class="text-gray-600">
                            Past perfect shows which action happened first when talking about two past events.
                        </p>
                    </div>
                    
                    <div class="p-6 bg-gradient-to-br from-pastperf-light to-white rounded-xl">
                        <div class="text-4xl mb-3">üîó</div>
                        <h3 class="font-bold text-gray-800 mb-2">Time Connectors</h3>
                        <p class="text-gray-600">
                            Often used with "before", "after", "when", "by the time", "already".
                        </p>
                    </div>
                    
                    <div class="p-6 bg-gradient-to-br from-pastperf-light to-white rounded-xl">
                        <div class="text-4xl mb-3">üë•</div>
                        <h3 class="font-bold text-gray-800 mb-2">Same for All Subjects</h3>
                        <p class="text-gray-600">
                            Always use "had" - never "has" or "have" in past perfect tense.
                        </p>
                    </div>
                    
                    <div class="p-6 bg-gradient-to-br from-pastperf-light to-white rounded-xl">
                        <div class="text-4xl mb-3">üìñ</div>
                        <h3 class="font-bold text-gray-800 mb-2">Storytelling</h3>
                        <p class="text-gray-600">
                            Perfect for stories and reports when explaining what happened before the main events.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-pastperf-light py-8 text-center">
        <div class="container mx-auto px-4">
            <p class="text-pastperf font-semibold">Keep practicing and master Past Perfect! ‚è™‚ú®</p>
        </div>
    </footer>

    <script>
        // Exercise 1: Timeline Data
        const timelineData = [
            {
                scenario: "Sarah's busy morning",
                events: [
                    { action: "Sarah's alarm rang at 7 AM", time: "7:00 AM", order: 2 },
                    { action: "Sarah had already showered", time: "6:45 AM", order: 1 }
                ],
                options: [
                    "When Sarah's alarm rang, she already showered.",
                    "When Sarah's alarm rang, she had already showered.",
                    "When Sarah's alarm had rang, she already showered."
                ],
                correct: 1,
                explanation: "Use past perfect 'had showered' for the earlier action."
            },
            {
                scenario: "John's homework situation",
                events: [
                    { action: "John's teacher asked for homework", time: "9:00 AM", order: 2 },
                    { action: "John had forgotten to do his homework", time: "Previous night", order: 1 }
                ],
                options: [
                    "When the teacher asked for homework, John forgot to do it.",
                    "When the teacher asked for homework, John had forgotten to do it.",
                    "When the teacher had asked for homework, John forgot to do it."
                ],
                correct: 1,
                explanation: "Use past perfect 'had forgotten' for the earlier action."
            },
            {
                scenario: "Maria's travel experience",
                events: [
                    { action: "Maria arrived at the airport", time: "8:00 PM", order: 2 },
                    { action: "The plane had already departed", time: "7:30 PM", order: 1 }
                ],
                options: [
                    "When Maria arrived, the plane already departed.",
                    "When Maria had arrived, the plane already departed.",
                    "When Maria arrived, the plane had already departed."
                ],
                correct: 2,
                explanation: "Use past perfect 'had departed' for the earlier action."
            },
            {
                scenario: "Tom's movie night",
                events: [
                    { action: "Tom turned on the TV", time: "8:00 PM", order: 2 },
                    { action: "The movie had already started", time: "7:45 PM", order: 1 }
                ],
                options: [
                    "When Tom turned on the TV, the movie already started.",
                    "When Tom turned on the TV, the movie had already started.",
                    "When Tom had turned on the TV, the movie already started."
                ],
                correct: 1,
                explanation: "Use past perfect 'had started' for the earlier action."
            },
            {
                scenario: "Lisa's cooking disaster",
                events: [
                    { action: "Lisa opened the oven", time: "6:30 PM", order: 2 },
                    { action: "The cake had already burned", time: "Before 6:30 PM", order: 1 }
                ],
                options: [
                    "When Lisa opened the oven, the cake already burned.",
                    "When Lisa opened the oven, the cake had already burned.",
                    "When Lisa had opened the oven, the cake already burned."
                ],
                correct: 1,
                explanation: "Use past perfect 'had burned' for the earlier action."
            },
            {
                scenario: "David's phone call",
                events: [
                    { action: "David called his friend", time: "10:00 PM", order: 2 },
                    { action: "His friend had already gone to bed", time: "9:30 PM", order: 1 }
                ],
                options: [
                    "When David called, his friend already went to bed.",
                    "When David called, his friend had already gone to bed.",
                    "When David had called, his friend already went to bed."
                ],
                correct: 1,
                explanation: "Use past perfect 'had gone' for the earlier action."
            }
        ];

        // Exercise 2: Detective Story Data
        const detectiveStoryData = [
            {
                text: "Detective Smith arrived at the crime scene at 9 AM. The witness told him that the burglar _____ (escape) through the window before the police arrived.",
                answer: "had escaped",
                verb: "escape"
            },
            {
                text: "The detective noticed that someone _____ (break) the lock on the back door.",
                answer: "had broken",
                verb: "break"
            },
            {
                text: "The neighbors reported that they _____ (see) a suspicious person around the house the night before.",
                answer: "had seen",
                verb: "see"
            },
            {
                text: "When Detective Smith examined the safe, he discovered that the thief _____ (take) all the jewelry.",
                answer: "had taken",
                verb: "take"
            },
            {
                text: "The security guard admitted that he _____ (fall) asleep during his shift.",
                answer: "had fallen",
                verb: "fall"
            },
            {
                text: "Fingerprint analysis revealed that the criminal _____ (wear) gloves during the robbery.",
                answer: "had worn",
                verb: "wear"
            },
            {
                text: "The investigation showed that the burglar _____ (plan) the crime for several weeks.",
                answer: "had planned",
                verb: "plan"
            },
            {
                text: "By the end of the day, Detective Smith _____ (solve) the case and arrested the suspect.",
                answer: "had solved",
                verb: "solve"
            }
        ];

        // Exercise 3: Connector Data
        const connectorData = [
            {
                first: "I finished my homework.",
                second: "My friends came to visit.",
                connector: "before",
                sample: "I had finished my homework before my friends came to visit."
            },
            {
                first: "She studied English for 3 years.",
                second: "She moved to London.",
                connector: "before",
                sample: "She had studied English for 3 years before she moved to London."
            },
            {
                first: "They cleaned the house.",
                second: "The guests arrived.",
                connector: "before",
                sample: "They had cleaned the house before the guests arrived."
            },
            {
                first: "He saved enough money.",
                second: "He bought the car.",
                connector: "after",
                sample: "After he had saved enough money, he bought the car."
            },
            {
                first: "We ate dinner.",
                second: "We watched the movie.",
                connector: "after",
                sample: "After we had eaten dinner, we watched the movie."
            },
            {
                first: "The rain stopped.",
                second: "The children went outside to play.",
                connector: "after",
                sample: "After the rain had stopped, the children went outside to play."
            }
        ];

        // Exercise 4: Challenge Quiz Data
        const challengeQuestions = [
            {
                sentence: "By the time I arrived, the meeting _____ already _____.",
                options: ["has/started", "had/started", "have/started", "was/starting"],
                correct: 1,
                explanation: "Use past perfect 'had started' for actions completed before a past time."
            },
            {
                sentence: "She realized she _____ her keys at home.",
                options: ["forgot", "had forgotten", "has forgotten", "was forgetting"],
                correct: 1,
                explanation: "Use past perfect 'had forgotten' for the earlier action."
            },
            {
                sentence: "_____ you _____ Japanese before you moved to Tokyo?",
                options: ["Did/study", "Had/studied", "Have/studied", "Were/studying"],
                correct: 1,
                explanation: "Use past perfect 'Had you studied' for actions before a past event."
            },
            {
                sentence: "The students _____ the test before the teacher collected it.",
                options: ["finished", "had finished", "have finished", "were finishing"],
                correct: 1,
                explanation: "Use past perfect 'had finished' for the earlier action."
            },
            {
                sentence: "After they _____ dinner, they went for a walk.",
                options: ["ate", "had eaten", "have eaten", "were eating"],
                correct: 1,
                explanation: "Use past perfect 'had eaten' after 'after' with past tense main clause."
            }
        ];

        // Timeline Exercise Logic
        let timelineIndex = 0;

        function loadTimelineScenario() {
            if (timelineIndex >= timelineData.length) {
                timelineIndex = 0;
            }
            
            const scenario = timelineData[timelineIndex];
            document.getElementById('timeline-scenario').textContent = scenario.scenario;
            
            const eventsContainer = document.getElementById('timeline-events');
            eventsContainer.innerHTML = '';
            
            scenario.events.forEach((event, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-white rounded border';
                div.innerHTML = `
                    <span>${event.action}</span>
                    <span class="text-sm text-gray-600">${event.time}</span>
                `;
                eventsContainer.appendChild(div);
            });
            
            const optionsContainer = document.getElementById('timeline-options');
            optionsContainer.innerHTML = '';
            
            scenario.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'bg-white border-2 border-gray-300 p-4 rounded-lg hover:border-pastperf hover:bg-pastperf-light transition-colors text-left';
                button.textContent = option;
                button.addEventListener('click', () => checkTimelineAnswer(index));
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('timeline-feedback').classList.add('hidden');
            document.getElementById('next-timeline').classList.add('hidden');
            document.getElementById('timeline-current').textContent = timelineIndex + 1;
        }

        function checkTimelineAnswer(selectedIndex) {
            const scenario = timelineData[timelineIndex];
            const feedbackEl = document.getElementById('timeline-feedback');
            const isCorrect = selectedIndex === scenario.correct;
            
            if (isCorrect) {
                feedbackEl.textContent = `üéâ Correct! ${scenario.explanation}`;
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-green-100 text-green-800';
                document.getElementById('next-timeline').classList.remove('hidden');
            } else {
                feedbackEl.textContent = `‚ùå Wrong. Correct answer: "${scenario.options[scenario.correct]}". ${scenario.explanation}`;
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-red-100 text-red-800';
            }
            
            feedbackEl.classList.remove('hidden');
            
            const buttons = document.querySelectorAll('#timeline-options button');
            buttons.forEach(button => {
                button.disabled = true;
                button.classList.add('opacity-50');
            });
        }

        function nextTimelineScenario() {
            timelineIndex++;
            loadTimelineScenario();
        }

        // Detective Story Logic
        function setupDetectiveStory() {
            const container = document.getElementById('detective-story');
            container.innerHTML = '';
            
            detectiveStoryData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'mb-4';
                
                const text = item.text.replace('_____', '');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'story-input mx-2 px-3 py-2 border-2 border-gray-300 rounded w-40 text-center';
                input.placeholder = `had + ${item.verb}`;
                input.dataset.answer = item.answer;
                
                const textParts = item.text.split('_____');
                div.innerHTML = `<span class="text-lg">${textParts[0]}</span>`;
                div.appendChild(input);
                div.innerHTML += `<span class="text-lg">${textParts[1] || ''}</span>`;
                
                container.appendChild(div);
            });
        }

        function checkDetectiveStory() {
            const inputs = document.querySelectorAll('.story-input');
            let correct = 0;
            let completeStory = '';
            
            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.dataset.answer.toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    input.classList.remove('border-red-500');
                    input.classList.add('border-green-500', 'bg-green-50');
                    correct++;
                } else {
                    input.classList.remove('border-green-500');
                    input.classList.add('border-red-500', 'bg-red-50');
                }
                
                const storyText = detectiveStoryData[index].text.replace('_____', input.dataset.answer);
                completeStory += storyText + ' ';
            });
            
            document.getElementById('story-completed').textContent = correct;
            
            if (correct === detectiveStoryData.length) {
                document.getElementById('story-feedback').classList.remove('hidden');
                document.getElementById('complete-detective-story').textContent = completeStory;
                document.getElementById('story-feedback').className = 'mt-6 p-4 rounded-lg bg-green-100 text-green-800';
            }
        }

        function resetDetectiveStory() {
            const inputs = document.querySelectorAll('.story-input');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
            });
            document.getElementById('story-completed').textContent = '0';
            document.getElementById('story-feedback').classList.add('hidden');
        }

        // Connector Exercise Logic
        let connectorIndex = 0;

        function loadConnectorExercise() {
            if (connectorIndex >= connectorData.length) {
                connectorIndex = 0;
            }
            
            const exercise = connectorData[connectorIndex];
            document.getElementById('first-action').textContent = exercise.first;
            document.getElementById('second-action').textContent = exercise.second;
            document.getElementById('connector-word').textContent = exercise.connector;
            document.getElementById('connector-input').value = '';
            document.getElementById('connector-feedback').classList.add('hidden');
            document.getElementById('next-connector').classList.add('hidden');
            document.getElementById('connector-current').textContent = connectorIndex + 1;
        }

        function checkConnectorAnswer() {
            const userAnswer = document.getElementById('connector-input').value.trim().toLowerCase();
            const correctAnswer = connectorData[connectorIndex].sample.toLowerCase();
            const feedbackEl = document.getElementById('connector-feedback');
            
            // Check if the answer contains the key elements
            const hasHad = userAnswer.includes('had');
            const hasConnector = userAnswer.includes(connectorData[connectorIndex].connector);
            const isReasonable = userAnswer.length > 10;
            
            if (userAnswer === correctAnswer || (hasHad && hasConnector && isReasonable)) {
                feedbackEl.textContent = 'üéâ Great! Your sentence correctly uses past perfect!';
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-green-100 text-green-800';
                document.getElementById('next-connector').classList.remove('hidden');
            } else {
                feedbackEl.textContent = `üí≠ Sample answer: "${connectorData[connectorIndex].sample}"`;
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-blue-100 text-blue-800';
            }
            
            feedbackEl.classList.remove('hidden');
        }

        function nextConnectorExercise() {
            connectorIndex++;
            loadConnectorExercise();
        }

        // Challenge Quiz Logic
        let challengeIndex = 0;
        let challengeScore = 0;
        let challengeTotal = 0;

        function loadChallengeQuestion() {
            if (challengeIndex >= challengeQuestions.length) {
                challengeIndex = 0;
            }
            
            const question = challengeQuestions[challengeIndex];
            document.getElementById('challenge-sentence').textContent = question.sentence;
            
            const optionsContainer = document.getElementById('challenge-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'bg-white border-2 border-gray-300 p-4 rounded-lg hover:border-pastperf hover:bg-pastperf-light transition-colors text-left';
                button.textContent = option;
                button.addEventListener('click', () => checkChallengeAnswer(index));
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('challenge-feedback').classList.add('hidden');
        }

        function checkChallengeAnswer(selectedIndex) {
            const question = challengeQuestions[challengeIndex];
            challengeTotal++;
            document.getElementById('challenge-total').textContent = challengeTotal;
            
            const feedbackEl = document.getElementById('challenge-feedback');
            const isCorrect = selectedIndex === question.correct;
            
            if (isCorrect) {
                challengeScore++;
                document.getElementById('challenge-score').textContent = challengeScore;
                feedbackEl.textContent = `üéâ Correct! ${question.explanation}`;
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-green-100 text-green-800';
            } else {
                feedbackEl.textContent = `‚ùå Wrong. Correct answer: "${question.options[question.correct]}". ${question.explanation}`;
                feedbackEl.className = 'mt-4 p-3 rounded-lg font-semibold bg-red-100 text-red-800';
            }
            
            feedbackEl.classList.remove('hidden');
            
            const buttons = document.querySelectorAll('#challenge-options button');
            buttons.forEach(button => {
                button.disabled = true;
                button.classList.add('opacity-50');
            });
        }

        function nextChallengeQuestion() {
            challengeIndex++;
            loadChallengeQuestion();
        }

        // Event Listeners
        document.getElementById('check-timeline').addEventListener('click', () => {
            // Timeline check is handled by button clicks in options
        });
        document.getElementById('next-timeline').addEventListener('click', nextTimelineScenario);
        document.getElementById('check-story').addEventListener('click', checkDetectiveStory);
        document.getElementById('reset-story').addEventListener('click', resetDetectiveStory);
        document.getElementById('check-connector').addEventListener('click', checkConnectorAnswer);
        document.getElementById('next-connector').addEventListener('click', nextConnectorExercise);
        document.getElementById('challenge-next').addEventListener('click', nextChallengeQuestion);

        // Initialize all exercises
        loadTimelineScenario();
        setupDetectiveStory();
        loadConnectorExercise();
        loadChallengeQuestion();
    </script>
</body>
</html>